{"version":3,"sources":["../../src/spack/index.ts"],"sourcesContent":["import { bundle } from '@swc/core';\nimport { mkdir, writeFile } from 'fs';\nimport { basename, dirname, extname, join, relative } from 'path'\nimport { promisify } from 'util';\n\nimport parseSpackArgs from './options';\n\nconst write = promisify(writeFile);\nconst makeDir = promisify(mkdir);\n\n\n(async () => {\n    const { spackOptions } = await parseSpackArgs(process.argv);\n\n    function isUserDefinedEntry(name: string) {\n        if (typeof spackOptions.entry === 'string') {\n            return spackOptions.entry === name\n        }\n        if (Array.isArray(spackOptions.entry)) {\n            for (const e of spackOptions.entry) {\n                if (e === name) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        return name in spackOptions.entry;\n    }\n\n\n    async function build() {\n        const bundleStart = process.hrtime();\n        const output = await bundle(spackOptions);\n        const bundleEnd = process.hrtime(bundleStart);\n        console.info(`Bundling done: ${bundleEnd[0]}s ${bundleEnd[1] / 1000000}ms`);\n\n        const emitStart = process.hrtime();\n        if (spackOptions.output?.path) {\n            await Object.keys(output).map(async (name) => {\n                let fullPath = '';\n                if (isUserDefinedEntry(name)) {\n                    fullPath = join(spackOptions.output.path, spackOptions.output.name.replace('[name]', name));\n                } else {\n                    const ext = extname(name);\n                    const base = basename(name, ext);\n                    const filename = relative(process.cwd(), name);\n                    fullPath = join(spackOptions.output.path, dirname(filename), `${base}.js`)\n                }\n\n                await makeDir(dirname(fullPath), { recursive: true });\n                await write(fullPath, output[name].code, 'utf-8');\n                if (output[name].map) {\n                    await write(`${fullPath}.map`, output[name].map, 'utf-8')\n                }\n            });\n        } else {\n            throw new Error('Cannot print to stdout: not implemented yet')\n        }\n        const emitEnd = process.hrtime(emitStart);\n        console.info(`Done: ${emitEnd[0]}s ${emitEnd[1] / 1000000}ms`);\n\n    }\n\n    // if (cliOptions.watch) {\n    //     throw new Error('watch is not implemented yet')\n    // }\n\n    await build();\n})()"],"names":["write","makeDir","spackOptions","process","argv","isUserDefinedEntry","name","entry","Array","isArray","e","build","bundleStart","hrtime","output","bundleEnd","console","info","emitStart","path","Object","keys","map","fullPath","replace","ext","base","filename","cwd","recursive","code","Error","emitEnd"],"mappings":"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"}